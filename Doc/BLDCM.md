# BLDCM
 无刷直流电机不使用机械的电刷装置，采用方波自控式永磁同步电机，与有刷电机相比，它将转子和定子交换， 即无刷电机中使用电枢绕组作为定子，使用钕铁硼的**永磁材料作为转子**，以**霍尔传感器**取代碳刷换向器， 性能上相较一般的传统直流电机有很大优势。

 不过，单个的无刷电机不是一套完整的动力系统，无刷电机基本必须通过**无刷控制器**才能实现连续不断的运转。 普通的碳刷电机旋转的是绕组，而无刷电机不论是外转子结构还是内转子结构旋转的都是**磁铁**。

 无刷电机的**定子是产生旋转磁场的部分**，能够支撑转子进行旋转，主要由硅钢片、漆包线、轴承、 支撑件构成；而转子则是黏贴了钕铁硼磁铁、在定子旋转磁场的作用进行旋转的部件，主要由转轴、 磁铁、支持件构成。除此之外，定子与转子组成的**磁极对数**还影响着电机的**转速与扭力**。

## 1. some important parameter
1.1. 额定电压
无刷电机适合的工作电压，其实无刷电机适合的工作电压非常广，额定电压是指定了负载条件而得出的情况。 例如说，2212-850KV电机指定了1045螺旋桨的负载，其额定工作电压就是11V。如果减小负载，例如带7040螺旋桨， 那这个电机完全可以工作在22V电压下。但是这个工作电压也不是无限上升的，主要受制于电子控制器支持的最高频率。所以说，额定工作是由工作环境决定的。

1.2. KV值
**有刷直流电机是根据额定工作电压来标注额定转速的**，无刷电机引入了KV值的概念，而让用户可以直观的知道无刷电机在具体的工作电压下的具体转速。
$实际转速=KV值*工作电压$，这 就是KV的物理意义，就是在1V工作电压下每分钟的转速。无刷直流电机的转速与电压呈正比关系，**电机的转速会随着电压上升而线性上升**。 例如，2212-850KV电机在10V电压下的转速就是:$850*10=8500RPM$(RPM，每分钟转速)。 KV值与匝数是呈反比例关系的，例如2212-850KV，匝数是30T(15圈)，那在28T的情况下的KV值是:$850KV*30T/28T=910KV$。

1.3. 转矩与转速
转矩:(力矩、扭矩）电机中转子产生的可以用来带动机械负载的驱动力矩，我们可以理解为电机的力量。

转速:电机每分钟的转速。

电机的转矩和转速在同一个电机内永远是一个此消彼长的关系，**基本可以认为转矩和转速的乘积是一个定数**，即同一个电机的转速越高，必定其转矩越低，相反也依然。不可能要求个电机 的转速也更高，转矩也更高，这个规律通用于所有电机。例如:2212-850KV电机，在11V的 情况下可以带动1045桨，如果将电压上升一倍，其转速也提高一倍，如果此时负载仍然是 1045桨，那该电机将很快因为电流和温度的急剧上升而烧毁。

1.4 最大电流和最大功率
最大电流:电机能够承受并安全工作的最大电流

每个电机都有自己的力量上限，最大功率就是这个上限，如果工作情况超过了这个最大功率，就会导致电机高温烧毁。

1.5. 槽极结构（N：槽数，P：极数）
铁芯极数（槽数)∶定子硅钢片的槽数量, N->定子槽数

磁钢极数（极数)∶转子上磁钢的数量, P->转子极数

模型常见的内转子无刷电机结构有: 3N2P(有感电机常用)、12N4P(大部分内转子电机)

模型常见的外转子无刷电机结构有:9N6P、9N12P、12N8P、12N10P、12N14P、18N16P、24N20P。

模型用内转子无刷电机极数不高的原因:目前内转子电机多用于**减速**使用，所以要求的**转速都比较高**。电子转速=实际转速*电机极对数，电子控制器支持的最高电子转速往往都是一个定数，所以如果电机极对数太高的话，支持的最高电机转速就会下降，所以目前的内转子电机极数都是4以内。

1.6. 其他设计驱动需要的参数
定子电感：电动机静止时的定子绕组两端的电感。

定子电阻：在20℃下电动机每相绕组的直流电阻。

反电动势系数：在规定条件下，电动机绕组开路时，单位转速在电枢绕组中所产生的线感应电动势值。

## 2. 直流无刷电机工作原理

安培定则，右手螺旋定则

![](https://doc.embedfire.com/motor/motor_tutorial/zh/latest/_images/brushless_motor_working_process.png)

## 3. 直流无刷电机驱动设计与分析

3.1  控制电路原理设计与分析
我们使用**三相六臂全桥驱动电路**来驱动无刷电机，

![](https://doc.embedfire.com/motor/motor_tutorial/zh/latest/_images/three-phase_full-bridge.png)


在上图中导通Q1和Q4，其他都不导通，那么电流将从Q1流经U相绕组， 再从V相绕组流到Q4。这样也就完成了上一节中的第一步，同理，依次导通Q5Q4、 Q5Q2、Q3Q2、Q3Q6和Q1Q6， 这也就完成了6拍工作方式。但是，单片机的引脚直接驱动MOS管还是不行的，所以这里需要使用专用的IC来驱动MOS管。

此外我们需要知道转子的位置信息。 但并不需要连续的位置信息，只需要知道换相点的位置即可。 获取转子位置一般有两种方法，一种是使用**传感器**，例如霍尔传感器，一种是不使用传感器。 这里以霍尔传感器举例子。

3.1.1 霍尔传感器
霍尔传感器是根据霍尔效应制作的一种磁场传感器。

>霍尔效应：当电流垂直于外磁场通过半导体时， 载流子发生偏转，垂直于电流和磁场的方向会产生一附加电场，从而在半导体的两端产生电势差， 这一现象就是霍尔效应，这个电势差也被称为霍尔电势差。

在BLDC中一般采用3个开关型霍尔传感器测量转子的位置，由其输出的3位二进制编码去控制三相六臂全桥中的6个MOS管的导通实现换相。如果将一只霍尔传感器安装在靠近转子的位置，当N极逐渐靠近霍尔传感器即磁感器达到一定值时， 其输出是导通状态；当N极逐渐离开霍尔传感器、磁感应逐渐小时，其输出仍然保持导通状态； *只有磁场转变为S极便达到一定值时，其输出才翻转为截止状态*。在S和N交替变化下传感器输出波形占高、 低电平各占50%。如果转子是一对极，则电机旋转一周霍尔传感器输出一个周期的电压波形，如果转子是两对极， 则输出两个周期的波形。

在直流无刷电机中一般把3个霍尔传感器按间隔120度或60度的圆周分布来安装，如果按间隔120度来安装， 则3个霍尔传感器输出波形相差120度电度角，输出信号中高、低电平各占180度电度角。 如果规定输出信号高电平用“1”表示，低电平用“0”表示，则输出的三个信号可以用三位二进制码表示， 如下图所示。

![](https://doc.embedfire.com/motor/motor_tutorial/zh/latest/_images/hall_mounting_position.png)

转子每旋转一周可以输出6个不同的信号，这样正好可以满足我们条件。只要我们根据霍尔传感器输出的值来导通MOS管即可。 通常厂家也会给出真值表。一般有两个,一个是对应顺时针旋转，另一个对应的是逆时针旋转。配套电机的真值表如下。

![image](https://user-images.githubusercontent.com/54738414/188605117-420bde00-dbf0-404e-9caa-e43b07e331db.png)

上表的意思是：当检测到的3个霍尔传感器的值，则导通对应值的MOS管。例如，检测到霍尔a、 霍尔b和霍尔c分别为0、0和1，则导通B-和C+对应的MOS管，其他MOS管都要处于截止状态。 当导通对应的MOS管后电机就会旋转一个角度，旋转到下一个霍尔值改变为101，这时在关闭B-和C+， 导通A+和B-，这样电机有将会旋转一个角度直到下一个霍尔值改变， 只要我们按表中的霍尔值导通对应的MOS管电机就可按一定的方向旋转。


在对MOS管的控制有中两个特殊情况需要注意一下：

1. 导通状态不变而发热：当按真值表中对应霍尔值导通MOS管后，就保持导通状态不变时，此时电机就会旋转到对应位置保持不变， 此时电路中的电能将只能转换为热能，不能转换为机械能，而我们的电机绕组时候的是漆包铜线， 其内阻非常的小，电流就会非常的大，这将会产生大量的热而导致电源或者电机被烧毁。

2. 同时导通导致烧毁：在上面的三相六臂全桥驱动电路原理图中如果同时导通Q1和Q2，或者导通 Q3和Q4，或者导通Q5和Q6，只要导通以上对应的两个MOS管， 都会导致电路中的电机不能正常工作，而MOS管直接将电源的正负极接通，这无疑将会烧毁电源或者MOS管。


![](https://doc.embedfire.com/products/link/zh/latest/_images/ebf_brushless.jpg)


## 4. 直流无刷电机控制实现

4.1. 速度控制原理
通常我们使用电机不仅仅只是让电机旋转这么简单，更多的时候需要对速度进行控制， 按照以下无刷直流电机转速计算公式可知，影响电机转速的三个参量分别是电枢回路的总电阻$Ra$, 调整电枢绕组的供电电压$U_a$或者调整励磁磁通$φ$。也就是说，想要改变电机的转速， 必须对以上三个参量进行调整。

$V=(U_a-I_a\cdot R_a)/CEφ$

$U_a$——电机定子绕组的实际电压大小

$I_a$——电机绕组内通过的实际电流大小

$R_a$——电路系统中包含电机的回路电阻大小

$CE$——电势系数

$φ$——励磁磁通

在现实情况下，在已确定无刷直流电机选型及电机参数的情况下，改变系统总的电阻值Ra和电机的励磁磁通值难度是比较大的，因此，在一般情况下，我们可以对无刷直流电机的**供电电压**适当调整， 从而**降低线圈绕组通过电流大小**，以期达到控制电机转速的目的，同前面讲到的直流有刷减速电机一样， 直流无刷电机也可以使用脉宽调制信号（PWM）来进行速度控制，通常使用的PWM频率为十几或者几十千赫兹 （**不得超过MOS管的开关频率**），这样把需要通电的MOS管使用PWM来控制就可以实现速度的控制。

使用PWM控制直流无刷电机的策略包括PWM-ON、ON-PWM、H_PWM-L_ON、H_ON-L_PWM和H_PWM-L_PWM。 这5种控制策略，均是电机处于120°运行方式下进行的。如下图所示。

![](https://doc.embedfire.com/motor/motor_tutorial/zh/latest/_images/PWM_mode.png)


这5种调制方式为：

1. PWM-ON型。在120°导通区间，各开关管前60°采用PWM调制，后60°则恒通。

2. ON-PWM型。在120°导通区间，各开关管前60°恒通，后60°则采用PWM调制。

3. H_PWM-L_ON型。在120°导通区间，上桥臂开关管采用PWM调制，下桥臂恒通。

4. H_ON-L_PWM型。在120°导通区间，上桥臂开关管恒通，下桥臂采用PWM调制。

5. H_PWM-L_PWM型。在120°导通区间，上、下桥臂均采用PWM调制。